# 解决SpringCloud内存占用过高的问题

## 问题

为什么会需要解决内存问题呢？

因为当我在跟着乐优商城项目学习的时候，发现8G内存竟然已经不够用了！！！

解决方法按理说应该很简单：加内存嘛。

可是目前为止我已经购买了两条8G内存，都出现了内存不兼容的问题，导致电脑频繁蓝屏死机。

于是乎便开始寻求如何降低微服务的内存占用，以便达到学习开发之用。

## 解决方案

修改IDEA针对每个项目的jvm参数。

### 1. 打开Edit Configurations

![](https://i.loli.net/2019/11/22/PnLANVumcbjW9QI.png)

### 2. 在 environment卡片下的VM options输入框中填入：

```
-Xmx128m -Xms128m
```

这里要注意的是，register项目不需要太多资源（我这里设置128M）,Gateway和config服务可以比register多一点（256M）。其它业务性服务才需要更多的资源（512M）。

## 关于jvm配置的建议（了解）

参考1：http://blog.csdn.net/sdujava2011/article/details/50086933有如下描述

1. 设置JVM内存的参数有四个：

 -Xmx   Java Heap最大值，默认值为物理内存的1/4，最佳设值应该视物理内存大小及计算机内其他内存开销而定；

 -Xms   Java Heap初始值，Server端JVM最好将-Xms和-Xmx设为相同值，开发测试机JVM可以保留默认值；

 -Xmn   Java Heap Young区大小，不熟悉最好保留默认值；

 -Xss   每个线程的Stack大小，不熟悉最好保留默认值；

 参考2： https://www.cnblogs.com/w-wfy/p/6415856.html有如下描述：

一般用到最多的是

 -Xms512m  设置JVM促使内存为512m。此值可以设置与-Xmx相同，以避免每次垃圾回收完成后JVM重新分配内存。

 -Xmx512m ，设置JVM最大可用内存为512M。

 -Xmn200m：设置年轻代大小为200M。整个堆大小=年轻代大小 + 年老代大小 + 持久代大小。持久代一般固定大小为64m，所以增大年轻代后，将会减小年老代大小。此值对系统性能影响较大，Sun官方推荐配置为整个堆的3/8。

 -Xss128k：设置每个线程的堆栈大小。JDK5.0以后每个线程堆栈大小为1M，以前每个线程堆栈大小为256K。更具应用的线程所需内存大小进行调整。在相同物理内存下，减小这个值能生成更多的线程。但是操作系统对一个进程内的线程数还是有限制的，不能无限生成，经验值在3000~5000左右。